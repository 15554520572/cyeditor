(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{123:function(e,t,i){},231:function(e,t,i){},308:function(e,t,i){e.exports=i.p+"assets/img/round-rectangle.6e6408f1.svg"},309:function(e,t,i){e.exports=i.p+"assets/img/ellipse.5d2931d6.svg"},310:function(e,t,i){e.exports=i.p+"assets/img/hexagon.824c4bcf.svg"},311:function(e,t,i){e.exports=i.p+"assets/img/star.a1743878.svg"},312:function(e,t,i){e.exports=i.p+"assets/img/pentagon.ab8426d3.svg"},313:function(e,t,i){e.exports=i.p+"assets/img/diamond.a60ee67c.svg"},314:function(e,t,i){e.exports=i.p+"assets/img/tag.247a67c3.svg"},315:function(e,t,i){e.exports=i.p+"assets/img/polygon.58cab152.svg"},316:function(e,t,i){"use strict";var n=i(123);i.n(n).a},322:function(e,t,i){"use strict";i.r(t);var n=i(221),o=(i(231),i(152)),s=i.n(o),a=(i(234),i(235)),r=(i(60),i(49),i(26)),c=i.n(r),d=i(35),h=i.n(d),l=i(43),u=(i(36),i(37),i(19)),v=i(20),p=i(320),f=i(260),y=i(319),g=i(269),m=i.n(g),b=(i(64),i(273),i(277),i(279),i(160)),_=i.n(b),w=i(280),x=i.n(w);function k(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}k.prototype.clear=function(){this.size=0,this.__data__={hash:new Hash,map:new(x.a||ListCache),string:new Hash}},k.prototype.delete=function(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t},k.prototype.get=function(e){return getMapData(this,e).get(e)},k.prototype.has=function(e){return getMapData(this,e).has(e)},k.prototype.set=function(e,t){var i=getMapData(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};var E="Expected a function";function C(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(E);var i=function i(){var n=arguments,o=t?t.apply(this,n):n[0],s=i.cache;if(s.has(o))return s.get(o);var a=e.apply(this,n);return i.cache=s.set(o,a)||s,a};return i.cache=new(C.Cache||k),i}C.Cache=k;var T=C,z=function(){var e="Expected a function",t=Math.max,i=s.a||function(){return(new Date).getTime()};return function(n,o,s){var a,r,c,d,h,u,v,p,f,y=0,g=!1,m=!0;if("function"!=typeof n)throw new TypeError(e);if(o=o<0?0:+o||0,!0===s){var b=!0;m=!1}else p=s,f=Object(l.a)(p),!p||"object"!==f&&"function"!==f||(b=!!s.leading,g="maxWait"in s&&t(+s.maxWait||0,o),m="trailing"in s?!!s.trailing:m);function _(e,t){t&&clearTimeout(t),r=u=v=void 0,e&&(y=i(),c=n.apply(h,a),u||r||(a=h=void 0))}function w(){var e=o-(i()-d);e<=0||e>o?_(v,r):u=setTimeout(w,e)}function x(){_(m,u)}function k(){if(a=arguments,d=i(),h=this,v=m&&(u||!b),!1===g)var e=b&&!u;else{r||b||(y=d);var t=g-(d-y),s=t<=0||t>g;s?(r&&(r=clearTimeout(r)),y=d,c=n.apply(h,a)):r||(r=setTimeout(x,t))}return s&&u?u=clearTimeout(u):u||o===g||(u=setTimeout(w,o)),e&&(s=!0,c=n.apply(h,a)),!s||u||r||(a=h=void 0),c}return k.cancel=function(){u&&clearTimeout(u),r&&clearTimeout(r),y=0,r=u=v=void 0},k}}(),O=function(e,t,i){var n=!0,o=!0;return!1===i?n=!1:Object(l.a)(i)===Object(l.a)({})&&(n="leading"in i?i.leading:n,o="trailing"in i?i.trailing:o),(i=i||{}).leading=n,i.maxWait=t,i.trailing=o,z(e,t,i)},S={},L=_.a,D=S.toString,N=S.hasOwnProperty,P=N.toString,M=P.call(Object),H=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},R=document.querySelectorAll.bind(document);function j(e){var t,i;return!(!e||"[object Object]"!==D.call(e))&&(!(t=L(e))||"function"==typeof(i=N.call(t,"constructor")&&t.constructor)&&P.call(i)===M)}var I={hasOwn:N,isFunction:H,query:R,isPlainObject:j,extend:function e(){var t,i,n,o,s,a,r=arguments[0]||{},c=1,d=arguments.length,u=!1;for("boolean"==typeof r&&(u=r,r=arguments[c]||{},c++),"object"===Object(l.a)(r)||H(r)||(r={}),c===d&&(r=this,c--);c<d;c++)if(null!=(t=arguments[c]))for(i in t)n=r[i],r!==(o=t[i])&&(u&&o&&(j(o)||(s=h()(o)))?(s?(s=!1,a=n&&h()(n)?n:[]):a=n&&j(n)?n:{},r[i]=e(u,a,o)):void 0!==o&&(r[i]=o));return r},css:function(e,t){if("string"==typeof t)return e.ownerDocument.defaultView.getComputedStyle(e,null)[t];if("object"===Object(l.a)(t))for(var i in t)e.style[i]=t[i]},addClass:function(e,t){e.classList.add(t)},removeClass:function(e,t){e.classList.remove(t)},hasClass:function(e,t){return e.classList.contains(t)},offset:function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}},once:function(e,t,i){e.addEventListener(t,function n(){i(),e.removeEventListener(t,n)})},$:function(e){return document.getElementById(e)},isNode:function(e){if(e&&1===e.nodeType&&window.Node&&e instanceof Node)return!0},debounce:z,throttle:O,RGBToHex:function(e,t,i){return((e<<16)+(t<<8)+i).toString(16).padStart(6,"0")},memoize:T,guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},G=i(318),B=i(297),A=i.n(B),$=i(75),Y=i(163),X=i.n(Y),W=(i(54),i(34),function(){function e(){Object(u.a)(this,e),this.events={}}return Object(v.a)(e,[{key:"on",value:function(e,t,i){for(var n=arguments.length,o=new Array(n>3?n-3:0),s=3;s<n;s++)o[s-3]=arguments[s];void 0===this.events[e]&&(this.events[e]=[]),this.events[e].push({scope:i,callback:t,args:o})}},{key:"off",value:function(e,t,i){if(void 0!==this.events[e]){this.events[e]=this.events[e].filter(function(e){return e.scope!==i||e.callback!==t})}}},{key:"has",value:function(e,t,i){if(void 0===this.events[e])return!1;var n=this.events[e].length;if(void 0===t&&void 0===i)return n>0;return this.events[e].some(function(e){var n=!i||e.scope===i,o=e.callback===t;if(n&&o)return!0})}},{key:"emit",value:function(e,t){if(void 0!==this.events[e]){for(var i={type:e,target:t},n=this.events[e].slice(),o=arguments.length,s=new Array(o>2?o-2:0),a=2;a<o;a++)s[a-2]=arguments[a];var r=!0,c=!1,d=void 0;try{for(var h,l=X()(n);!(r=(h=l.next()).done);r=!0){var u=h.value;u&&u.callback&&u.callback.apply(u.scope,[i].concat(s,Object($.a)(u.args)))}}catch(e){c=!0,d=e}finally{try{r||null==l.return||l.return()}finally{if(c)throw d}}}}},{key:"debug",value:function(){for(var e="",t=A()(this.events),i=0;i<t.length;i++){var n=Object(G.a)(t[i],2),o=n[0],s=n[1],a=!0,r=!1,c=void 0;try{for(var d,h=X()(s);!(a=(d=h.next()).done);a=!0){var l=d.value,u=l.scope&&l.scope.constructor.name||"Anonymous";e+="".concat(u,' listening for "').concat(o,'"\n')}}catch(e){r=!0,c=e}finally{try{a||null==h.return||h.return()}finally{if(r)throw c}}}return e}}]),e}()),U=(i(122),{container:!1,commands:[{command:"undo",icon:"icon-undo",disabled:!0,title:"撤销"},{command:"redo",icon:"icon-Redo",disabled:!0,title:"重做"},{command:"zoomin",icon:"icon-zoomin",disabled:!1,title:"放大",separator:!0},{command:"zoomout",icon:"icon-zoom",disabled:!1,title:"缩小"},{command:"boxselect",icon:"icon-selection",disabled:!1,title:"框选",selected:!1},{command:"copy",icon:"icon-copy",disabled:!0,title:"复制",separator:!0},{command:"paste",icon:"icon-paste",disabled:!0,title:"粘贴"},{command:"delete",icon:"icon-delete",disabled:!0,title:"删除"},{command:"leveldown",icon:"icon-arrow-to-bottom",disabled:!0,title:"层级后置"},{command:"levelup",icon:"icon-top-arrow-from-top",disabled:!0,title:"层级前置"},{command:"line-straight",icon:"icon-Line-Tool",disabled:!1,title:"直线",selected:!1,separator:!0},{command:"line-taxi",icon:"icon-gongzuoliuchengtu",disabled:!1,title:"折线",selected:!1},{command:"line-bezier",icon:"icon-Bezier-",disabled:!1,title:"曲线",selected:!1},{command:"gridon",icon:"icon-grid",disabled:!1,title:"表格辅助",selected:!1,separator:!0},{command:"fit",icon:"icon-fullscreen",disabled:!1,title:"适应画布"},{command:"save",icon:"icon-save",disabled:!1,title:"保存",separator:!0}]}),F=function(){function e(t,i){Object(u.a)(this,e),this.cy=t,this._init(i),this._listeners={},this._initEvents()}return Object(v.a)(e,[{key:"_init",value:function(e){var t=this;this._options=c()({},U,e),h()(this._options.toolbar)&&(this._options.commands=this._options.commands.filter(function(e){return t._options.toolbar.indexOf(e.command)>-1})),this._initShapePanel()}},{key:"_initEvents",value:function(){var e=this;this._listeners.command=function(t){var i=t.target.getAttribute("data-command");if(i){var n=e._options.commands.find(function(e){return e.command===i});["boxselect","gridon"].indexOf(i)>-1?e.rerender(i,{selected:!n.selected}):["line-straight","line-bezier","line-taxi"].indexOf(i)>-1?(e.rerender("line-straight",{selected:"line-straight"===i}),e.rerender("line-bezier",{selected:"line-bezier"===i}),e.rerender("line-taxi",{selected:"line-taxi"===i})):"fit"===i&&e.rerender("fit",{icon:"icon-fullscreen"===n.icon?"icon-fullscreen-exit":"icon-fullscreen"}),n&&e.cy.trigger("cyeditor.toolbar-command",n)}},this._panel.addEventListener("click",this._listeners.command),this._listeners.select=this._selectChange.bind(this),this.cy.on("select unselect",this._listeners.select)}},{key:"_selectChange",value:function(){var e=this.cy.$(":selected");if(e&&e.length!==this._last_selected_length){var t=e.length>0;this._options.commands.forEach(function(e){["delete","copy","leveldown","levelup"].indexOf(e.command)>-1&&(e.disabled=!t)}),this._panelHtml()}this._last_selected_length=e}},{key:"_initShapePanel",value:function(){var e=this._options;if(e.container){if("string"==typeof e.container?this._panel=I.query(e.container)[0]:I.isNode(e.container)&&(this._panel=e.container),!this._panel)return void console.error("There is no any element matching your container")}else this._panel=document.createElement("div"),document.body.appendChild(this._panel);this._panelHtml()}},{key:"_panelHtml",value:function(){var e="";this._options.commands.forEach(function(t){var i=t.command,n=t.title,o=t.icon,s=t.disabled,a=t.selected,r=t.separator,c="".concat(o," ").concat(s?"disable":""," ").concat(!0===a?"selected":"");r&&(e+='<span class="separator"></span>'),e+='<i data-command="'.concat(i,'" class="iconfont command ').concat(c,'" title="').concat(n,'"></i>')}),this._panel.innerHTML=e}},{key:"rerender",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._options.commands.find(function(t){return t.command===e}),o=c()(n,i);o&&I.query("i[data-command=".concat(e,"]")).forEach(function(e){e.parentNode===t._panel&&(o.icon&&(e.className="iconfont command ".concat(o.icon)),o.disabled?I.addClass(e,"disable"):I.removeClass(e,"disable"),o.selected?I.addClass(e,"selected"):I.removeClass(e,"selected"))})}}]),e}(),Z=function(){function e(t,i){Object(u.a)(this,e),this.cy=t;this._options=I.extend(!0,{},{stackOrder:-1,gridSpacing:35,strokeStyle:"#CCCCCC",lineWidth:1,lineDash:[5,8],zoomDash:!0,panGrid:!0,snapToGrid:!0,drawGrid:!0},i),this._init(),this._initEvents()}return Object(v.a)(e,[{key:"_init",value:function(){this._container=this.cy.container(),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this._container.append(this.canvas)}},{key:"_initEvents",value:function(){var e=this;window.addEventListener("resize",function(){return e._resizeCanvas()}),this.cy.ready(function(){e._resizeCanvas(),e._options.snapToGrid&&e.snapAll(),e.cy.on("zoom",function(){return e._drawGrid()}),e.cy.on("pan",function(){return e._drawGrid()}),e.cy.on("free",function(t){return e._nodeFreed(t)}),e.cy.on("add",function(t){return e._nodeAdded(t)})})}},{key:"_resizeCanvas",value:function(){var e=this,t=this._container.getBoundingClientRect();this.canvas.height=t.height,this.canvas.width=t.width,this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.canvas.style.zIndex=this._options.stackOrder,setTimeout(function(){var t=I.offset(e.canvas),i=I.offset(e._container);e.canvas.style.top=-(t.top-i.top),e.canvas.style.left=-(t.left-i.left),e._drawGrid()},0)}},{key:"_drawGrid",value:function(){if(this.clear(),this._options.drawGrid){var e=this.cy.zoom(),t=this._container.getBoundingClientRect(),i=t.width,n=t.height,o=this._options.gridSpacing*e,s=this.cy.pan(),a=s.x%o,r=s.y%o;if(this.ctx.strokeStyle=this._options.strokeStyle,this.ctx.lineWidth=this._options.lineWidth,this._options.zoomDash){for(var c=this._options.lineDash.slice(),d=0;d<c.length;d++)c[d]=this._options.lineDash[d]*e;this.ctx.setLineDash(c)}else this.ctx.setLineDash(this._options.lineDash);this._options.panGrid?this.ctx.lineDashOffset=-s.y:this.ctx.lineDashOffset=0;for(var h=a;h<i;h+=o)this.ctx.beginPath(),this.ctx.moveTo(h,0),this.ctx.lineTo(h,n),this.ctx.stroke();this._options.panGrid?this.ctx.lineDashOffset=-s.x:this.ctx.lineDashOffset=0;for(var l=r;l<n;l+=o)this.ctx.beginPath(),this.ctx.moveTo(0,l),this.ctx.lineTo(i,l),this.ctx.stroke()}}},{key:"_nodeFreed",value:function(e){this._options.snapToGrid&&this.snapNode(e.target)}},{key:"_nodeAdded",value:function(e){this._options.snapToGrid&&this.snapNode(e.target)}},{key:"snapNode",value:function(e){var t=e.position(),i=Math.floor(t.x/this._options.gridSpacing),n=Math.floor(t.y/this._options.gridSpacing);e.position({x:(i+.5)*this._options.gridSpacing,y:(n+.5)*this._options.gridSpacing})}},{key:"snapAll",value:function(){var e=this;this.cy.nodes().each(function(t){e.snapNode(t)})}},{key:"refresh",value:function(){this._resizeCanvas()}},{key:"snapOn",value:function(){this._options.snapToGrid=!0,this.snapAll(),this.cy.trigger("cyeditor.snapgridon")}},{key:"snapOff",value:function(){this._options.snapToGrid=!1,this.cy.trigger("cyeditor.snapgridoff")}},{key:"gridOn",value:function(){this._options.drawGrid=!0,this._drawGrid(),this.cy.trigger("cyeditor.gridon")}},{key:"gridOff",value:function(){this._options.drawGrid=!1,this._drawGrid(),this.cy.trigger("cyeditor.gridoff")}},{key:"clear",value:function(){var e=this._container.getBoundingClientRect(),t=e.width,i=e.height;this.ctx.clearRect(0,0,t,i)}}]),e}();function q(e,t){void 0===e.scratch("_undoRedo")&&e.scratch("_undoRedo",{});var i=e.scratch("_undoRedo");return void 0===t?i:i[t]}function V(e,t,i){var n=q(e);n[t]=i,e.scratch("_undoRedo",n)}function J(e){function t(e,i,n){for(var o=n?i:function(e){for(var t={},i=0;i<e.length;i++)t[e[i].id()]=!0;return e.filter(function(e,i){"number"==typeof e&&(e=i);for(var n=e.parent()[0];null!==n&&n;){if(n&&t[n.id()])return!1;n=n.parent()[0]}return!0})}(i),s=0;s<o.length;s++){var a=o[s],r=a.position("x"),c=a.position("y");a.isParent()||a.position({x:r+e.x,y:c+e.y}),t(e,a.children(),!0)}}function i(t){return"string"==typeof t?e.$(t):t}function n(e){return i(e).restore()}function o(t){var i={};return e.nodes().positions(function(e,n){"number"==typeof e&&(e=n),i[e.id()]={x:e.position("x"),y:e.position("y")};var o=t[e.id()];return{x:o.x,y:o.y}}),i}function s(e){var i={};if(e.firstTime){var n=void 0===e.parentData?null:e.parentData,o=e.nodes.union(e.nodes.descendants());i.elesToRestore=o.union(o.connectedEdges()),i.movedEles=e.nodes.move({parent:n}),t({x:e.posDiffX,y:e.posDiffY},i.movedEles)}else i.elesToRestore=e.movedEles.remove(),i.movedEles=e.elesToRestore.restore();return e.callback&&(i.callback=e.callback,e.callback(i.movedEles)),i}function a(t,i){for(var n=[],o=q(e,"instance").actions,s=0;s<t.length;s++){var a=t[s];o.hasOwnProperty(a.name)||console.error("Action "+a.name+" does not exist as an undoable function")}for(var r=0;r<t.length;r++){var c=t[r];c.param.firstTime=t.firstTime;var d=void 0;d="undo"===i?o[c.name]._undo(c.param):o[c.name]._do(c.param),n.unshift({name:c.name,param:d})}return n}return{add:{_do:function(t){return t.firstTime?e.add(t):n(t)},_undo:e.remove},remove:{_do:e.remove,_undo:n},restore:{_do:n,_undo:e.remove},select:{_do:function(e){return i(e).select()},_undo:function(e){return i(e).unselect()}},unselect:{_do:function(e){return i(e).unselect()},_undo:function(e){return i(e).select()}},move:{_do:function(e){var t=i(e.eles),n=t.nodes(),o=t.edges();return{oldNodes:n,newNodes:n.move(e.location),oldEdges:o,newEdges:o.move(e.location)}},_undo:function(t){var i=e.collection(),n={};if(t.newNodes.length>0){n.parent=t.newNodes[0].parent();for(var o=0;o<t.newNodes.length;o++){var s=t.newNodes[o].move({parent:t.oldNodes[o].parent()});i.union(s)}}else{n.source=n.newEdges[0].source(),n.target=n.newEdges[0].target();for(var a=0;a<t.newEdges.length;a++){var r=t.newEdges[a].move({source:t.oldEdges[a].source(),target:t.oldEdges[a].target()});i.union(r)}}return{eles:i,location:n}}},drag:{_do:function(e){return e.move&&t(e.positionDiff,e.nodes),e},_undo:function(e){var i={x:-1*e.positionDiff.x,y:-1*e.positionDiff.y},n={positionDiff:e.positionDiff,nodes:e.nodes,move:!0};return t(i,e.nodes),n}},layout:{_do:function(t){if(t.firstTime){var n,s=function(){for(var t={},i=e.nodes(),n=0;n<i.length;n++){var o=i[n];t[o.id()]={x:o.position("x"),y:o.position("y")}}return t}();return(n=t.eles?i(t.eles).layout(t.options):e.layout(t.options))&&n.run&&n.run(),s}return o(t)},_undo:function(e){return o(e)}},changeParent:{_do:function(e){return s(e)},_undo:function(e){return s(e)}},batch:{_do:function(e){return a(e,"do")},_undo:function(e){return a(e,"undo")}}}}var K={clipboardSize:0,beforeCopy:null,afterCopy:null,beforePaste:null,afterPaste:null},Q=function(){function e(t,i){return Object(u.a)(this,e),this.cy=t,this._options=c()({},K,i),this._counter=0,this._listeners={},this._init()}return Object(v.a)(e,[{key:"_init",value:function(){var e=this,t=this._getScratch();if(this._oldIdToNewId={},!t.isInitialized){t.isInitialized=!0;var i={};t.instance={copy:function(t,n){var o=n||e._getItemId();t.unselect();var s=t.nodes().descendants(),a=t.nodes().union(s).filter(":visible"),r=a.edgesWith(a).filter(":visible");return e._options.beforeCopy&&e._options.beforeCopy(a.union(r)),i[o]={nodes:a.jsons(),edges:r.jsons()},e._options.afterCopy&&e._options.afterCopy(i[o]),e._targetPos=a[0]?a[0].position():{x:0,y:0},o},paste:function(t){var n=t||e._getItemId(!0),o=e.cy.collection();if(e._options.beforePaste&&e._options.beforePaste(i[n]),i[n]){var s=e.changeIds(i[n].nodes),a=e.changeIds(i[n].edges);e._oldIdToNewId={},e.cy.batch(function(){(o=e.cy.add(s).union(e.cy.add(a))).select()})}return e._options.afterPaste&&e._options.afterPaste(o),e.cy.trigger("cyeditor.paste"),o}}}return t.instance}},{key:"_getItemId",value:function(e){return e?"item_"+this._counter:"item_"+ ++this._counter}},{key:"changeIds",value:function(e){e=I.extend(!0,[],e);for(var t=0;t<e.length;t++){var i=e[t],n=I.guid();this._oldIdToNewId[i.data.id]=n,i.data.id=n}for(var o=0;o<e.length;o++){for(var s=e[o],a=["source","target","parent"],r=0;r<a.length;r++){var c=a[r];s.data[c]&&this._oldIdToNewId[s.data[c]]&&(s.data[c]=this._oldIdToNewId[s.data[c]])}s.position.x&&(s.position.x+=50,s.position.y+=50)}return e}},{key:"_getScratch",value:function(){return this.cy.scratch("_clipboard")||this.cy.scratch("_clipboard",{}),this.cy.scratch("_clipboard")}},{key:"destroy",value:function(){this.cy.off("mousemove",this._listeners.onmousemove)}}]),e}(),ee=i(133),te=i.n(ee),ie={container:!1,viewLiveFramerate:0,dblClickDelay:200,removeCustomContainer:!0,rerenderDelay:500},ne=function(){function e(t,i){Object(u.a)(this,e),this.cy=t,this._options=I.extend({},ie,i),this._init(t,i)}return Object(v.a)(e,[{key:"_init",value:function(){this._cyListeners=[],this._contianer=this.cy.container(),this.boundingBox=this.bb();var e=this._contianer.getBoundingClientRect();this.width=e.width,this.height=e.height,this._initPanel(),this._initThumbnail(),this._initView(),this._initOverlay()}},{key:"_addCyListener",value:function(e,t){this._cyListeners.push({events:e,handler:t}),this.cy.on(e,t)}},{key:"_removeCyListeners",value:function(){var e=this.cy;this._cyListeners.forEach(function(t){e.off(t.events,t.handler)}),e.offRender(this._onRenderHandler)}},{key:"_initPanel",value:function(){var e=this._options;if(e.container){if("string"==typeof e.container?this.$panel=I.query(e.container)[0]:I.isNode(e.container)&&(this.$panel=e.container),!this.$panel)return void console.error("There is no any element matching your container")}else this.$panel=document.createElement("div"),document.body.appendChild(this.$panel);this.$panel.classList.add("cytoscape-navigator"),this._setupPanel(),this._addCyListener("resize",this.resize.bind(this))}},{key:"_setupPanel",value:function(){var e=this.$panel.getBoundingClientRect();this.panelWidth=e.width,this.panelHeight=e.height}},{key:"_initThumbnail",value:function(){this.$thumbnail=document.createElement("img"),this.$panel.appendChild(this.$thumbnail),this._setupThumbnailSizes(),this._updateThumbnailImage()}},{key:"_setupThumbnailSizes",value:function(){this.boundingBox=this.bb(),this.thumbnailZoom=Math.min(this.panelHeight/this.boundingBox.h,this.panelWidth/this.boundingBox.w),this.thumbnailPan={x:(this.panelWidth-this.thumbnailZoom*(this.boundingBox.x1+this.boundingBox.x2))/2,y:(this.panelHeight-this.thumbnailZoom*(this.boundingBox.y1+this.boundingBox.y2))/2}}},{key:"_checkThumbnailSizesAndUpdate",value:function(){var e=this.thumbnailZoom,t=this.thumbnailPan.x,i=this.thumbnailPan.y;this._setupThumbnailSizes(),this._updateThumbnailImage(),e===this.thumbnailZoom&&t===this.thumbnailPan.x&&i===this.thumbnailPan.y||this._setupView()}},{key:"_initView",value:function(){this.$view=document.createElement("div"),this.$view.className="cytoscape-navigatorView",this.$panel.appendChild(this.$view);var e=window.getComputedStyle(this.$view);this.viewBorderTop=te()(e["border-top-width"],10),this.viewBorderRight=te()(e["border-right-width"],10),this.viewBorderBottom=te()(e["border-bottom-width"],10),this.viewBorderLeft=te()(e["border-left-width"],10),this.viewBorderHorizontal=this.viewBorderLeft+this.viewBorderRight,this.viewBorderVertical=this.viewBorderTop+this.viewBorderBottom,this._setupView(),this._addCyListener("zoom pan",this._setupView.bind(this))}},{key:"_setupView",value:function(){if(!this.viewLocked){var e=this.cy.zoom(),t=this.cy.pan();this.viewW=this.width/e*this.thumbnailZoom,this.viewX=-t.x*this.viewW/this.width+this.thumbnailPan.x-this.viewBorderLeft,this.viewH=this.height/e*this.thumbnailZoom,this.viewY=-t.y*this.viewH/this.height+this.thumbnailPan.y-this.viewBorderTop,this.$view.style.width=this.viewW+"px",this.$view.style.height=this.viewH+"px",this.$view.style.position="absolute",this.$view.style.left=this.viewX+"px",this.$view.style.top=this.viewY+"px"}}},{key:"_initOverlay",value:function(){this.$overlay=document.createElement("div"),this.$overlay.className="cytoscape-navigatorOverlay",this.$panel.appendChild(this.$overlay),this.overlayHookPointX=0,this.overlayHookPointY=0,this._initEventsHandling()}},{key:"_initEventsHandling",value:function(){var e=this,t=["mousedown","mousewheel","DOMMouseScroll","touchstart"],i=["mouseup","mouseout","mousemove","touchmove","touchend"],n=function(t){var i=I.extend({},t);if("touchstart"===i.type&&(i.offsetX=e.viewX+e.viewW/2,i.offsetY=e.viewY+e.viewH/2),void 0===i.offsetX||void 0===i.offsetY){var n=I.offset(i.target);i.offsetX=i.pageX-n.left,i.offsetY=i.pageY-n.top}return"mousedown"===i.type||"touchstart"===i.type?e._eventMoveStart(i):"mousewheel"!==i.type&&"DOMMouseScroll"!==i.type||e._eventZoom(i),t.preventDefault(),!1},o=function(t){var i=I.extend({},t);if(e.overlayInMovement){if("touchend"===i.type?(i.offsetX=e.viewX+e.viewW/2,i.offsetY=e.viewY+e.viewH/2):"touchmove"===i.type&&(i.pageX=i.touches[0].pageX,i.pageY=i.touches[0].pageY),i.target&&(void 0===i.offsetX||void 0===i.offsetY)){var n=I.offset(i.target);i.offsetX=i.pageX-n.left,i.offsetY=i.pageY-n.top}if(i.target&&i.target!==e.$overlay){var o=I.offset(i.target),s=I.offset(e.$overlay);if(!o||!s)return!1;i.offsetX=i.offsetX-s.left+o.left,i.offsetY=i.offsetY-s.top+o.top}return"mousemove"===i.type||"touchmove"===i.type?e._eventMove(i):"mouseup"!==i.type&&"touchend"!==i.type||e._eventMoveEnd(i),t.preventDefault(),!1}};t.forEach(function(t){e.$overlay.addEventListener(t,n)}),i.forEach(function(e){window.addEventListener(e,o)}),this._removeEventsHandling=function(){i.forEach(function(e){window.removeEventListener(e,o)}),t.forEach(function(t){e.$overlay.addEventListener(t,n)})}}},{key:"_eventMoveStart",value:function(e){var t=(new Date).getTime();this.overlayLastMoveStartTime&&this.overlayLastMoveStartTime+this._options.dblClickDelay>t?(this.overlayLastMoveStartTime=0,this.overlayInMovement=!0,this.overlayHookPointX=this.viewW/2,this.overlayHookPointY=this.viewH/2,!1!==this._options.viewLiveFramerate?this._eventMove({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2}):this._eventMoveEnd({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2}),this.cy.reset(),this.overlayInMovement=!1):(this.overlayLastMoveStartTime=t,this.overlayInMovement=!0,this.viewLocked=!0,e.offsetX>=this.viewX&&e.offsetX<=this.viewX+this.viewW&&e.offsetY>=this.viewY&&e.offsetY<=this.viewY+this.viewH?(this.overlayHookPointX=e.offsetX-this.viewX,this.overlayHookPointY=e.offsetY-this.viewY):(this.overlayHookPointX=this.viewW/2,this.overlayHookPointY=this.viewH/2,this._eventMove(e)))}},{key:"_eventMove",value:function(e){var t=this;this._checkMousePosition(e),this.overlayInMovement&&(this.viewX=e.offsetX-this.overlayHookPointX,this.viewY=e.offsetY-this.overlayHookPointY,this.$view.style.left=this.viewX+"px",this.$view.style.top=this.viewY+"px",!1!==this._options.viewLiveFramerate&&(0===this._options.viewLiveFramerate?this._moveCy():this.overlayTimeout||(this.overlayTimeout=setTimeout(function(){t._moveCy(),t.overlayTimeout=!1},1e3/this._options.viewLiveFramerate))))}},{key:"_checkMousePosition",value:function(e){e.offsetX>this.viewX&&e.offsetX<this.viewX+this.viewBorderHorizontal+this.viewW&&e.offsetY>this.viewY&&e.offsetY<this.viewY+this.viewBorderVertical+this.viewH?this.$panel.classList.add("mouseover-view"):this.$panel.classList.remove("mouseover-view")}},{key:"_eventMoveEnd",value:function(e){this.viewLocked=!1,this.$panel.classList.remove("mouseover-view"),this.overlayInMovement&&(this._eventMove(e),!1===this._options.viewLiveFramerate&&this._moveCy(),this.overlayInMovement=!1)}},{key:"_eventZoom",value:function(e){var t=Math.pow(10,e.wheelDeltaY/1e3||e.wheelDelta/1e3||e.detail/-32),i={left:e.offsetX,top:e.offsetY};this.cy.zoomingEnabled()&&this._zoomCy(t,i)}},{key:"_updateThumbnailImage",value:function(){var e=this;if(!this._thumbnailUpdating){this._thumbnailUpdating=!0;this._onRenderHandler=I.throttle(function(){e._checkThumbnailSizesAndUpdate(),e._setupView();var t=e.$thumbnail;if(t){var i=e.panelWidth,n=e.panelHeight,o=e.boundingBox,s=Math.min(i/o.w,n/o.h),a=(i-s*o.w)/2,r=(n-s*o.h)/2,c=e.cy.png({full:!0,scale:s});c.indexOf("image/png")<0?t.removeAttribute("src"):t.setAttribute("src",c),t.style.position="absolute",t.style.left=a+"px",t.style.top=r+"px"}},this._options.rerenderDelay),this.cy.onRender(this._onRenderHandler)}}},{key:"_moveCy",value:function(){this.cy.pan({x:-(this.viewX+this.viewBorderLeft-this.thumbnailPan.x)*this.width/this.viewW,y:-(this.viewY+this.viewBorderLeft-this.thumbnailPan.y)*this.height/this.viewH})}},{key:"_zoomCy",value:function(e){var t={x:this.width/2,y:this.height/2};this.cy.zoom({level:this.cy.zoom()*e,renderedPosition:t})}},{key:"destroy",value:function(){if(this._removeCyListeners(),this._removeEventsHandling(),this._options.container&&!this._options.removeCustomContainer)for(var e=this.$panel.childNodes,t=e.length-1;t>=0;t--)this.$panel.removeChild(e[t]);else this.$panel.parentNode.removeChild(this.$panel)}},{key:"resize",value:function(){var e=this._contianer.getBoundingClientRect();this.width=e.width,this.height=e.height,this._setupPanel(),this._checkThumbnailSizesAndUpdate(),this._setupView()}},{key:"bb",value:function(){var e=this.cy.elements().boundingBox();return 0===e.w||0===e.h?{x1:0,x2:1/0,y1:0,y2:1/0,w:1/0,h:1/0}:e}}]),e}(),oe=(i(301),{preview:!0,hoverDelay:150,handleNodes:"node",snap:!1,snapThreshold:50,snapFrequency:15,noEdgeEventsInDraw:!1,disableBrowserGestures:!0,handlePosition:function(e){return"middle top"},handleInDrawMode:!1,edgeType:function(e,t){return"flat"},loopAllowed:function(e){return!1},nodeLoopOffset:-50,nodeParams:function(e,t){return{}},edgeParams:function(e,t,i){return{}},ghostEdgeParams:function(){return{}},show:function(e){},hide:function(e){},start:function(e){},complete:function(e,t,i){},stop:function(e){},cancel:function(e,t){},hoverover:function(e,t){},hoverout:function(e,t){},previewon:function(e,t,i){},previewoff:function(e,t,i){},drawon:function(){},drawoff:function(){}});var se={disableGestures:function(){if(this.saveGestureState(),this.cy.zoomingEnabled(!1).panningEnabled(!1).boxSelectionEnabled(!1),this.options.disableBrowserGestures){var e=this.windowListenerOptions;window.addEventListener("touchstart",this.preventDefault,e),window.addEventListener("touchmove",this.preventDefault,e),window.addEventListener("wheel",this.preventDefault,e)}return this},resetGestures:function(){if(this.cy.zoomingEnabled(this.lastZoomingEnabled).panningEnabled(this.lastPanningEnabled).boxSelectionEnabled(this.lastBoxSelectionEnabled),this.options.disableBrowserGestures){var e=this.windowListenerOptions;window.removeEventListener("touchstart",this.preventDefault,e),window.removeEventListener("touchmove",this.preventDefault,e),window.removeEventListener("wheel",this.preventDefault,e)}return this},saveGestureState:function(){var e=this.cy;return this.lastPanningEnabled=e.panningEnabled(),this.lastZoomingEnabled=e.zoomingEnabled(),this.lastBoxSelectionEnabled=e.boxSelectionEnabled(),this}};var ae={addCytoscapeListeners:function(){var e=this,t=this.cy,i=this.options;return this.addListener(t,"drag",function(){e.grabbingNode=!0}),this.addListener(t,"free",function(){e.grabbingNode=!1}),this.addListener(t,"mouseover","node",function(t){e.show(t.target)}),this.addListener(t,"tap","node",function(t){var i=t.target;i.same(e.handleNode)||e.show(i)}),this.addListener(t,"position","node",function(t){t.target.same(e.sourceNode)&&e.hide()}),this.addListener(t,"tapstart","node",function(t){var i=t.target;i.same(e.handleNode)?e.start(e.sourceNode):e.drawMode?e.start(i):i.same(e.sourceNode)&&e.hide()}),this.addListener(t,"tapdrag",function(t){e.update(t.position)}),this.addListener(t,"tapdragover","node",function(t){e.preview(t.target)}),this.addListener(t,"tapdragout","node",function(t){i.snap&&t.target.same(e.targetNode)||e.unpreview(t.target)}),this.addListener(t,"tapend",function(){e.stop()}),this.addListener(t,"remove",function(t){t.target.same(e.sourceNode)&&e.hide()}),this}},re=(i(302),function(e){return Object(l.a)(e)===Object(l.a)("")});function ce(e,t,i){var n={};return c()(n,t,e),c()(n.data,t.data,e.data),re(t.classes)?n.classes=t.classes+" "+i:h()(t.classes)?n.classes=t.classes.join(" ")+" "+i:n.classes=i,n}var de={makeEdges:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.cy,i=this.options,n=this.presumptiveTargets,o=this.previewEles,s=this.active,a=this.sourceNode,r=this.targetNode,c=e?"eh-preview":"",d=t.collection(),h=i.edgeType(a,r);if(s&&h&&(!e||i.preview)){if(!r||0===r.size())return o.remove(),void this.emit("cancel",this.mp(),a,n);if(!e&&i.preview)return o.removeClass("eh-preview").style("events",""),void this.emit("complete",this.mp(),a,r,o);var l,u=a.position(),v=r.position();if(l=a.same(r)?{x:u.x+i.nodeLoopOffset,y:u.y+i.nodeLoopOffset}:{x:(u.x+v.x)/2,y:(u.y+v.y)/2},"node"===h){var p=t.add(ce({group:"nodes",position:l},i.nodeParams(a,r),c)),f=t.add(ce({group:"edges",data:{source:a.id(),target:p.id()}},i.edgeParams(a,r,0),c)),y=t.add(ce({group:"edges",data:{source:p.id(),target:r.id()}},i.edgeParams(a,r,1),c));d=d.merge(p).merge(f).merge(y)}else{var g=t.add(ce({group:"edges",data:{source:a.id(),target:r.id()}},i.edgeParams(a,r,0),c));d=d.merge(g)}return e?(this.previewEles=d,d.style("events","no")):(d.style("events",""),this.emit("complete",this.mp(),a,r,d)),this}},makePreview:function(){return this.makeEdges(!0),this},removePreview:function(){return this.previewShown()&&this.previewEles.remove(),this},previewShown:function(){return this.previewEles.nonempty()&&this.previewEles.inside()},updateEdge:function(){var e,t,i=this,n=this.sourceNode,o=this.ghostNode,s=this.cy,a=this.mx,r=this.my,d=this.options,h=a,l=r;if(n)return o&&0!==o.length&&!o.removed()||(t=this.ghostEles=s.collection(),s.batch(function(){(o=i.ghostNode=s.add({group:"nodes",classes:"eh-ghost eh-ghost-node",position:{x:0,y:0}})).style({"background-color":"blue",width:1e-4,height:1e-4,opacity:0,events:"no"});var t=d.ghostEdgeParams();(e=s.add(c()({},t,{group:"edges",data:c()({},t.data,{source:n.id(),target:o.id()})}))).addClass("eh-ghost eh-ghost-edge"),e.style({events:"no"})}),t.merge(o).merge(e)),o.position({x:h,y:l}),this},handleShown:function(){return this.handleNode.nonempty()&&this.handleNode.inside()},setHandleFor:function(e){var t=this,i=this.options,n=this.cy,o=Object(l.a)(i.handlePosition)===Object(l.a)("")?function(){return i.handlePosition}:i.handlePosition,s=e.position(),a=e.outerHeight(),r=e.outerWidth(),c=0,d=0,h=o(e).toLowerCase().split(/\s+/),u=h[0],v=h[1];"left"===u?c=-r/2:"right"===u&&(c=r/2),"top"===v?d=-a/2:"bottom"===v&&(d=a/2);var p={x:this.hx=s.x+c,y:this.hy=s.y+d};return this.handleShown()?this.handleNode.position(p):n.batch(function(){t.handleNode=n.add({classes:"eh-handle",position:p,grabbable:!1,selectable:!1}),t.handleNode.style("z-index",9007199254740991)}),this},removeHandle:function(){return this.handleShown()&&this.handleNode.remove(),this}};i(304);var he={show:function(e){var t=this.options,i=this.drawMode;if(this.canStartOn(e)&&(!i||t.handleInDrawMode))return this.sourceNode=e,this.setHandleFor(e),this.emit("show",this.hp(),this.sourceNode),this},hide:function(){return this.removeHandle(),this.emit("hide",this.hp(),this.sourceNode),this},start:function(e){this.canStartOn(e)&&(this.active=!0,this.sourceNode=e,this.sourceNode.addClass("eh-source"),this.disableGestures(),this.disableEdgeEvents(),this.emit("start",this.hp(),e))},update:function(e){if(this.active){var t=e;return this.mx=t.x,this.my=t.y,this.updateEdge(),this.throttledSnap(),this}},preview:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.options,o=this.sourceNode,s=this.ghostNode,a=this.ghostEles,r=this.presumptiveTargets,c=this.previewEles,d=this.active,h=o,l=e.same(h),u=n.loopAllowed(e),v=e.same(s),p=!n.edgeType(h,e),f=e.same(this.handleNode),y=e.same(this.targetNode);if(!d||f||v||p||y||l&&!u)return!1;this.targetNode.nonempty()&&this.unpreview(this.targetNode),clearTimeout(this.previewTimeout);var g=function(){t.targetNode=e,r.merge(e),e.addClass("eh-presumptive-target"),e.addClass("eh-target"),t.emit("hoverover",t.mp(),h,e),n.preview&&(e.addClass("eh-preview"),a.addClass("eh-preview-active"),o.addClass("eh-preview-active"),e.addClass("eh-preview-active"),t.makePreview(),t.emit("previewon",t.mp(),h,e,c))};return i&&n.hoverDelay>0?this.previewTimeout=setTimeout(g,n.hoverDelay):g(),!0},unpreview:function(e){if(this.active&&!e.same(this.handleNode)){var t=this.previewTimeout,i=this.sourceNode,n=this.previewEles,o=this.ghostEles,s=this.cy;clearTimeout(t),this.previewTimeout=null;var a=i;return e.removeClass("eh-preview eh-target eh-presumptive-target eh-preview-active"),o.removeClass("eh-preview-active"),i.removeClass("eh-preview-active"),this.targetNode=s.collection(),this.removePreview(a,e),this.emit("hoverout",this.mp(),a,e),this.emit("previewoff",this.mp(),a,e,n),this}},stop:function(){if(this.active){var e=this.sourceNode,t=this.targetNode,i=this.ghostEles,n=this.presumptiveTargets;return clearTimeout(this.previewTimeout),e.removeClass("eh-source"),t.removeClass("eh-target eh-preview eh-hover"),n.removeClass("eh-presumptive-target"),this.makeEdges(),this.removeHandle(),i.remove(),this.clearCollections(),this.resetGestures(),this.enableEdgeEvents(),this.active=!1,this.emit("stop",this.mp(),e),this}},snap:function(){if(!this.active||!this.options.snap)return!1;var e=this.cy,t=this.targetNode,i=this.options.snapThreshold,n=this.mp(),o=function(e){return(e.outerWidth()+e.outerHeight())/4},s=I.memoize(function(e){return t=e.position(),((i=n).x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y);var t,i},function(e){return e.id()}),a=function(e){return s(e)<=function(e){var t=o(e)+i;return t*t}(e)},r=e.nodes(a).sort(function(e,t){return s(e)-s(t)}),c=!1;t.nonempty()&&!a(t)&&this.unpreview(t);for(var d=0;d<r.length;d++){var h=r[d];if(h.same(t)||this.preview(h,!1)){c=!0;break}}return c},canStartOn:function(e){var t,i=this.options,n=this.previewEles,o=this.ghostEles,s=this.handleNode,a=this.enabled,r=this.active,c=this.grabbingNode;return a&&!r&&!c&&(null==e||!(function(e){return n.anySame(e)}(t=e)||function(e){return s.same(e)}(t)||function(e){return o.anySame(e)}(t))&&function(e){return e.filter(i.handleNodes).length>0}(e))},canStartDrawModeOn:function(e){return this.canStartOn(e)&&this.drawMode},canStartNonDrawModeOn:function(e){return this.canStartOn(e)&&!this.drawMode}};function le(e,t,i,n,o){return Object(l.a)(i)!==Object(l.a)("")&&(o=n=i,i=null),null==o&&(o=!1),{target:e,event:t,selector:i,callback:n,options:o}}function ue(e){return e instanceof Element}var ve={addListener:function(e,t,i,n,o){var s=le(e,t,i,n,o);return this.listeners.push(s),ue(s.target)?s.target.addEventListener(s.event,s.callback,s.options):s.selector?s.target.addListener(s.event,s.selector,s.callback,s.options):s.target.addListener(s.event,s.callback,s.options),this},addListeners:function(){var e=this;return this.addCytoscapeListeners(),this.addListener(this.cy,"destroy",function(){return e.destroy()}),this},removeListener:function(e,t,i,n,o){for(var s=le(e,t,i,n,o),a=this.listeners.length-1;a>=0;a--){var r=this.listeners[a];if(!(s.target!==r.target||s.event!==r.event||null!=s.selector&&s.selector!==r.selector||null!=s.callback&&s.callback!==r.callback)){this.listeners.splice(a,1),ue(s.target)?s.target.removeEventListener(s.event,s.callback,s.options):s.selector?s.target.removeListener(s.event,s.selector,s.callback,s.options):s.target.removeListener(s.event,s.callback,s.options);break}}return this},removeListeners:function(){for(var e=this.listeners.length-1;e>=0;e--){var t=this.listeners[e];this.removeListener(t.target,t.event,t.selector,t.callback,t.options)}return this},emit:function(e,t){for(var i=this.options,n=this.cy,o=arguments.length,s=new Array(o>2?o-2:0),a=2;a<o;a++)s[a-2]=arguments[a];n.emit({type:"eh".concat(e),position:t},s);var r=i[e];return null!=r&&r.apply(void 0,s),this}},pe=function(){function e(t,i){Object(u.a)(this,e),this.cy=t,this.listeners=[],this.enabled=!0,this.drawMode=!1,this.active=!1,this.grabbingNode=!1,this.handleNode=t.collection(),this.clearCollections(),this.hx=0,this.hy=0,this.hr=0,this.mx=0,this.my=0,this.options=c()({},oe,i),this.saveGestureState(),this.addListeners(),this.throttledSnap=I.throttle(this.snap.bind(this),1e3/i.snapFrequency),this.preventDefault=function(e){return e.preventDefault()};var n=!1;try{var o=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("test",null,o)}catch(e){}this.windowListenerOptions=!n||{capture:!0,passive:!1}}return Object(v.a)(e,[{key:"destroy",value:function(){this.removeListeners()}},{key:"setOptions",value:function(e){c()(this.options,e)}},{key:"mp",value:function(){return{x:this.mx,y:this.my}}},{key:"hp",value:function(){return{x:this.hx,y:this.hy}}},{key:"clearCollections",value:function(){this.previewEles=this.cy.collection(),this.ghostEles=this.cy.collection(),this.ghostNode=this.cy.collection(),this.sourceNode=this.cy.collection(),this.targetNode=this.cy.collection(),this.presumptiveTargets=this.cy.collection()}},{key:"enable",value:function(){return this.enabled=!0,this.emit("enable"),this}},{key:"disable",value:function(){return this.enabled=!1,this.emit("disable"),this}},{key:"toggleDrawMode",value:function(e){var t=this.cy,i=this.options;return this.drawMode=null!=e?e:!this.drawMode,this.drawMode?(this.prevUngrabifyState=t.autoungrabify(),t.autoungrabify(!0),!i.handleInDrawMode&&this.handleShown()&&this.hide(),this.emit("drawon")):(t.autoungrabify(this.prevUngrabifyState),this.emit("drawoff")),this}},{key:"enableDrawMode",value:function(){return this.toggleDrawMode(!0)}},{key:"disableDrawMode",value:function(){return this.toggleDrawMode(!1)}},{key:"disableEdgeEvents",value:function(){return this.options.noEdgeEventsInDraw&&this.cy.edges().style("events","no"),this}},{key:"enableEdgeEvents",value:function(){return this.options.noEdgeEventsInDraw&&this.cy.edges().style("events",""),this}}]),e}(),fe=pe.prototype;[se,ae,de,he,ve].forEach(function(e){return c()(fe,e)});var ye=pe,ge=(i(305),{handleColor:"#000000",enabled:!0,minNodeWidth:30,minNodeHeight:30,triangleSize:10,selector:"node",lines:3,padding:5,start:function(e){},complete:function(e,t,i){},stop:function(e){}});var me=function(){function e(t,i){Object(u.a)(this,e),this.cy=t,this._container=this.cy.container(),this._listeners={},this._drawMode=!1,this._drawsClear=!0,this._options={},this._init(i)}return Object(v.a)(e,[{key:"destroy",value:function(){var e=this._options;e&&(e.unbind(),this._options={})}},{key:"disable",value:function(){this._options.enabled=!1,this._options.disabled=!0}},{key:"enable",value:function(){this._options.enabled=!0,this._options.disabled=!1}},{key:"resize",value:function(){this.cy.trigger("cyeditor.noderesize-resize")}},{key:"drawon",value:function(){this._drawMode=!0,this._prevUngrabifyState=this.cy.autoungrabify(),this.cy.autoungrabify(!0),this.cy.trigger("cyeditor.noderesize-drawon")}},{key:"drawoff",value:function(){this._drawMode=!1,this.cy.autoungrabify(this._prevUngrabifyState),this.cy.trigger("cyeditor.noderesize-drawoff")}},{key:"_init",value:function(e){this._options=I.extend(!0,{},ge,e),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this._container.append(this.canvas),this._listeners._sizeCanvas=I.debounce(this._sizeCanvas,250).bind(this),this._listeners._sizeCanvas(),this._initEvents()}},{key:"_sizeCanvas",value:function(){var e=this,t=this._container.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height,I.css(this.canvas,{position:"absolute",top:0,left:0,zIndex:"999"}),setTimeout(function(){var t=I.offset(e.canvas),i=I.offset(e._container);I.css(e.canvas,{top:-(t.top-i.top)+"px",left:-(t.left-i.left)+"px"})},0)}},{key:"clearDraws",value:function(){if(!this._drawsClear){var e=this._container.getBoundingClientRect(),t=e.width,i=e.height;this.canvas.getContext("2d").clearRect(0,0,t,i),this._drawsClear=!0}}},{key:"_disableGestures",value:function(){this._lastPanningEnabled=this.cy.panningEnabled(),this._lastZoomingEnabled=this.cy.zoomingEnabled(),this._lastBoxSelectionEnabled=this.cy.boxSelectionEnabled(),this.cy.zoomingEnabled(!1).panningEnabled(!1).boxSelectionEnabled(!1)}},{key:"_resetGestures",value:function(){this.cy.zoomingEnabled(this._lastZoomingEnabled).panningEnabled(this._lastPanningEnabled).boxSelectionEnabled(this._lastBoxSelectionEnabled)}},{key:"_resetToDefaultState",value:function(){this.clearDraws(),this.sourceNode=null,this._resetGestures()}},{key:"_drawHandle",value:function(e){this.ctx.fillStyle=this._options.handleColor,this.ctx.strokeStyle=this._options.handleColor;for(var t=this._options.padding*this.cy.zoom(),i=e.renderedPosition(),n=e.renderedOuterWidth()+2*t,o=e.renderedOuterHeight()+2*t,s=this._options.triangleSize*this.cy.zoom(),a=i.x+n/2-s,r=i.y+o/2,c=i.x+n/2,d=i.y+o/2-s,h=this._options.lines,l=s/h,u=s/h,v=1.5*this.cy.zoom(),p=0;p<h-1;p++)this.ctx.beginPath(),this.ctx.moveTo(a,r),this.ctx.lineTo(c,d),this.ctx.lineTo(c,d+v),this.ctx.lineTo(a+v,r),this.ctx.lineTo(a,r),this.ctx.closePath(),this.ctx.fill(),a+=l,d+=u;this.ctx.beginPath(),this.ctx.moveTo(c,r),this.ctx.lineTo(c,d),this.ctx.lineTo(a,r),this.ctx.closePath(),this.ctx.fill(),this._drawsClear=!1}},{key:"_initEvents",value:function(){var e=this;window.addEventListener("resize",this._listeners._sizeCanvas),this.cy.on("cyeditor.noderesize-resize",this._listeners._sizeCanvas),this._grabbingNode=!1,this._lastPanningEnabled=this.cy.panningEnabled(),this._lastZoomingEnabled=this.cy.zoomingEnabled(),this._lastBoxSelectionEnabled=this.cy.boxSelectionEnabled(),this.cy.style().selector(".noderesize-resized").css({width:"data(width)",height:"data(height)"}),this._listeners.transformHandler=function(){e.clearDraws()},this._listeners._startHandler=this._startHandler.bind(this),this.cy.bind("zoom pan",this._listeners.transformHandler);var t=function(){if(!e._options.disabledd&&!e._drawMode)return!e._mdownOnHandle&&void 0},i=function(){e._drawMode||e._mdownOnHandle&&clearTimeout(void 0)},n=function(){e._grabbingNode=!1},o=function(){e._drawMode||setTimeout(function(){return e.clearDraws()},50)},s=function(t){t.target.id()===e._lastActiveId&&setTimeout(function(){e._resetToDefaultState()},16)},a=function(t){var i=t.target;e.sourceNode||setTimeout(function(){e.clearDraws(),e._drawHandle(i),i.trigger("cyeditor.noderesize-showhandle")},16)},r=function(){e.clearDraws()},c=this._options.selector;this.cy.on("mouseover tap",c,this._listeners._startHandler).on("mouseover tapdragover",c,t).on("mouseout tapdragout",c,i).on("drag position",c,o).on("grab",c,r).on("drag",c,function(){e._grabbingNode=!0}).on("free",c,n).on("remove",c,s).on("tap",c,a),this._options.unbind=function(){window.removeEventListener("resize",e._listeners._sizeCanvas),e.cy.off("mouseover",c,e._listeners._startHandler).off("mouseover",c,t).off("mouseout",c,i).off("drag position",c,o).off("grab",c,r).off("free",c,n).off("remove",c,s).off("tap",c,a),e.cy.unbind("zoom pan",e._listeners.transformHandler)}}},{key:"_startHandler",value:function(e){var t=this,i=e.target;if(!(this._options.disabledd||this._drawMode||this._mdownOnHandle||this._grabbingNode||i.isParent())){this._listeners.lastMdownHandler&&(this._container.removeEventListener("mousedown",this._listeners.lastMdownHandler,!0),this._container.removeEventListener("touchstart",this._listeners.lastMdownHandler,!0)),this._lastActiveId=i.id(),this.clearDraws(),this._drawHandle(i),i.trigger("cyeditor.noderesize-showhandle");var n={},o=function e(o){t._container.removeEventListener("mousedown",e,!0),t._container.removeEventListener("touchstart",e,!0);var a=o.touches?o.touches[0].pageX:o.pageX,r=o.touches?o.touches[0].pageY:o.pageY,c=a-I.offset(t._container).left,d=r-I.offset(t._container).top;if(n.x=c,n.y=d,0===o.button||o.touches){var h=t._options.padding,l=i.renderedPosition(),u=i.renderedOuterWidth()+2*h,v=i.renderedOuterHeight()+2*h,p=t._options.triangleSize*t.cy.zoom();if(function(e,t,i,n){var o=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),s=o<0?-1:1,a=(t.y*n.x-t.x*n.y+(n.y-t.y)*e.x+(t.x-n.x)*e.y)*s,r=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*s;return a>0&&r>0&&a+r<2*o*s}({x:c,y:d},{x:l.x+u/2-p,y:l.y+v/2},{x:l.x+u/2,y:l.y+v/2-p},{x:l.x+u/2,y:l.y+v/2})){i.addClass("noderesize-resized"),t._mdownOnHandle=!0,o.preventDefault(),o.stopPropagation(),t.sourceNode=i,i.trigger("cyeditor.noderesize-start");var f={width:i.width(),height:i.height()},y=function(e){t._mdownOnHandle&&(t._mdownOnHandle=!1,window.removeEventListener("mousemove",s),window.removeEventListener("touchmove",s),t._resetToDefaultState(),t._options.stop(i),i.trigger("cyeditor.noderesize-stop"),t.cy.trigger("cyeditor.noderesize-resized",[i,f,{width:i.width(),height:i.height()}]))};return["mouseup","touchend","touchcancel","blur"].forEach(function(e){I.once(window,e,y)}),window.addEventListener("mousemove",s),window.addEventListener("touchmove",s),t._disableGestures(),t._options.start(i),!1}}},s=function(e){var o=e.touches?e.touches[0].pageX:e.pageX,s=e.touches?e.touches[0].pageY:e.pageY,a=o-I.offset(t._container).left,r=s-I.offset(t._container).top,c=a-n.x,d=r-n.y;n.x=a,n.y=r;var h=e.ctrlKey,l=i.data("width")||i.width(),u=i.data("height")||i.height();if(h){var v=l/u;0===d?d=c*=v:c=d=(d<0?Math.min(c,d):Math.max(c,d))*v}return c/=t.cy.zoom(),d/=t.cy.zoom(),i.data("width",Math.max(l+2*c,t._options.minNodeWidth)),i.data("height",Math.max(u+2*d,t._options.minNodeHeight)),t.cy.trigger("cyeditor.noderesize-resizing",[i,{width:i.width(),height:i.height()}]),t.clearDraws(),t._drawHandle(i),!1};this._container.addEventListener("mousedown",o,!0),this._container.addEventListener("touchstart",o,!0),this._listeners.lastMdownHandler=o}}}]),e}(),be=(i(307),i(150)),_e={container:!1,attrs:["name","height","width","color","background-color"]},we=function(){function e(t,i){Object(u.a)(this,e),this.cy=t,this._options=c()({},_e,i),this._infos={},this.selected=[],this._initPanel(),this._initEvents()}return Object(v.a)(e,[{key:"_initEvents",value:function(){var e=this;this._panel.addEventListener("input",function(t){e._options.attrs.indexOf(t.target.name)>-1&&(e._infos[t.target.name]=t.target.value,e._changeElementInfo(t.target.name,t.target.value))}),this.cy.on("select unselect",function(){e.showElementsInfo()})}},{key:"_initPanel",value:function(){var e=this._options;if(e.container){if("string"==typeof e.container?this._panel=I.query(e.container)[0]:I.isNode(e.container)&&(this._panel=e.container),!this._panel)return void console.error("There is no any element matching your container")}else this._panel=document.createElement("div"),document.body.appendChild(this._panel);this._panelHtml(),this._panel.style.display="none"}},{key:"_panelHtml",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{showName:!0,showBgColor:!0,showColor:!0,showRect:!0,colorTitle:"文字"};this._panel.innerHTML='<div class="panel-title">元素'.concat(e.titile||"",'</div>\n              <div class="panel-body" id="info-items">\n                <div class="info-item-wrap" style="').concat(e.showName?"":"display:none",'">名称：\n                    <input class="input info-item" name="name" type="text" value="">\n                </div>\n                <div class="info-item-wrap" style="').concat(e.showRect?"":"display:none",'">尺寸：\n                    <div class="info-item">\n                        <input class="input width" name="width" autocomplete="off" type="number" step="1" value="">\n                        <input class="input height" name="height" autocomplete="off" type="number" step="1" value="">\n                    </div>\n                </div>\n                <div class="info-item-wrap" style="').concat(e.showColor?"":"display:none",'">').concat(e.colorTitle,'：\n                    <div class="info-item">\n                        <input class="input color-input" name="color" autocomplete="off" type="color">\n                    </div>\n                </div>\n                <div class="info-item-wrap" style="').concat(e.showBgColor?"":"display:none",'">背景：\n                    <div class="info-item">\n                        <input class="input color-input" name="background-color" autocomplete="off" type="color">\n                    </div>\n                </div>\n            </div>')}},{key:"_changeElementInfo",value:function(e,t){"name"!==e?this.selected.forEach(function(i){i.isEdge()&&"color"===e&&(e="lineColor"),"background-color"===e&&(e="bg"),i.data(Object(be.a)({},e,t))}):this.selected[0].data({name:t})}},{key:"showElementsInfo",value:function(){var e=this,t=this.cy.$(":selected");this.selected=t;var i=t.every(function(e){return e.isNode()}),n={showName:i,showBgColor:i,showColor:!0,showRect:i,colorTitle:i?"文字":"颜色"};if(t.length>1)this._infos.name="",this._panelHtml(n);else if(1===t.length){this._panelHtml(n),this._panel.style.display="block";var o=t[0];this._options.attrs.forEach(function(t){if("name"===t)e._infos[t]=o.data("name");else if("color"===t||"background-color"===t){var i=o.numericStyle(t);e._infos[t]="#"+I.RGBToHex.apply(I,Object($.a)(i))}else e._infos[t]=o.numericStyle(t)})}else this._panel.style.display="none";this._options.attrs.filter(function(t){return e._infos[t]}).forEach(function(t){var i=I.query("#info-items input[name=".concat(t));i.length&&(i[0].value=e._infos[t])})}}]),e}(),xe=i(65),ke=i.n(xe),Ee=(i(102),{container:!1,addWhenDrop:!0,nodeTypes:[]}),Ce=function(){function e(t,i){Object(u.a)(this,e),this.cy=t,this._options=c()({},Ee,i),this._options.nodeTypes.forEach(function(e){e.width=e.width||76,e.height=e.height||76,e.category=e.category||"other"}),this._options.nodeTypes.length<1||(this._initShapePanel(),this._initShapeItems(),this._initEvents())}return Object(v.a)(e,[{key:"_initShapeItems",value:function(){var e=this._options.nodeTypes.filter(function(e){return e.type&&e.src});e.forEach(function(e){e._id=I.guid()});var t={},i=[];e.forEach(function(e){e.category?t[e.category]?t[e.category].push(e):t[e.category]=[e]:i.push(e)}),i.length&&(t.other=i);var n=ke()(t).map(function(e){var i=t[e].map(function(e){return'<img src="'.concat(e.src,'"  class="shape-item" draggable="true" data-id="').concat(e._id,'" />')}).join("");return'<div class="category">\n                  <div class="title">'.concat(e,'</div>\n                  <div class="shapes">').concat(i,"</div>\n                </div>")}).join("");this._shapePanel.innerHTML=n}},{key:"_initEvents",value:function(){var e=this,t=this.cy.container(),i=function(e){e.preventDefault()};I.query(".shape-item").forEach(function(e){e.addEventListener("dragstart",function(e){e.dataTransfer.setData("id",e.target.getAttribute("data-id"))})}),t.addEventListener("drop",function(i){var n=i.dataTransfer.getData("id");if(10===i.target.compareDocumentPosition(t)){var o={x:i.offsetX,y:i.offsetY};if(n){var s=e._options.nodeTypes.find(function(e){return e._id===n});e._addNodeToCy(s,o)}}}),t.addEventListener("dragenter",i),t.addEventListener("dragover",i)}},{key:"_addNodeToCy",value:function(e,t){var i=e.type,n=e.width,o=e.height,s=e.bg,a=e.resize,r=e.name,c=void 0===r?"":r,d=e.points,h=e.buildIn,l=void 0!==h&&h,u=e.src,v={type:i,name:c,resize:a,bg:s,width:n,height:o};l||(v.image=u);var p={group:"nodes",data:v,position:t};d&&(p.data.points=d),this._options.addWhenDrop&&this.cy.trigger("cyeditor.addnode",p)}},{key:"_initShapePanel",value:function(){var e=this._options;e.container?("string"==typeof e.container?this._shapePanel=I.query(e.container)[0]:I.isNode(e.container)&&(this._shapePanel=e.container),this._shapePanel||console.error("There is no any element matching your container")):(this._shapePanel=document.createElement("div"),document.body.appendChild(this._shapePanel))}}]),e}(),Te={menus:[{id:"remove",content:"remove",disabled:!1,divider:!0},{id:"hide",content:"hide",disabled:!1}],beforeShow:function(){return!0},beforeClose:function(){return!0}},ze=function(){function e(t,i){Object(u.a)(this,e),this.cy=t,this._options=c()({},Te,i),this._listeners={},this._init()}return Object(v.a)(e,[{key:"_init",value:function(){this._initContainer(),this._initDom(),this._initEvents()}},{key:"_initContainer",value:function(){this._container=this.cy.container(),this.ctxmenu=document.createElement("div"),this.ctxmenu.className="cy-editor-ctx-menu",this._container.append(this.ctxmenu)}},{key:"_initDom",value:function(){var e="";this._options.menus.forEach(function(t){e+='<div class="ctx-menu-item '.concat(t.disabled?"ctx-menu-item-disabled":"",'" data-menu-item="').concat(t.id,'">').concat(t.content,"</div>"),t.divider&&(e+='<div class="ctx-menu-divider" ></div>')}),this.ctxmenu.innerHTML=e}},{key:"_initEvents",value:function(){var e=this;this._listeners.eventCyTap=function(t){var i=t.renderedPosition||t.cyRenderedPosition,n=i.x,o=i.y;I.css(e.ctxmenu,{top:o+"px",left:n+"px"}),e.show(t)},this._listeners.eventTapstart=function(t){e.close(t)},this._listeners.click=function(t){var i=t.target.getAttribute("data-menu-item"),n=e._options.menus.find(function(e){return e.id===i});e.cy.trigger("cyeditor.ctxmenu",n)},this.ctxmenu.addEventListener("mousedown",this._listeners.click),this.cy.on("cxttap",this._listeners.eventCyTap),this.cy.on("tapstart",this._listeners.eventTapstart)}},{key:"disable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];I.query(".cy-editor-ctx-menu [data-menu-item=".concat(e,"]")).forEach(function(e){t?I.addClass(e,"ctx-menu-item-disabled"):I.removeClass(e,"ctx-menu-item-disabled")})}},{key:"changeMenus",value:function(e){this._options.menus=e,this._initDom()}},{key:"show",value:function(e){var t=this;if("function"==typeof this._options.beforeShow&&!this.isShow){var i=this._options.beforeShow(e,this._options.menus.slice(0));if(!i)return;if(i&&i.then)return void i.then(function(e){e&&(I.css(t.ctxmenu,{display:"block"}),t.isShow=!0)});h()(i)&&this.changeMenus(i),I.css(this.ctxmenu,{display:"block"}),this.isShow=!0}}},{key:"close",value:function(e){var t=this;if("function"==typeof this._options.beforeShow&&this.isShow){var i=this._options.beforeClose(e);!0===i?(I.css(this.ctxmenu,{display:"none"}),this.isShow=!1):i.then&&i.then(function(){I.css(t.ctxmenu,{display:"none"}),t.isShow=!1})}}},{key:"destroyCxtMenu",value:function(){this.ctxmenu.removeEventListener("mousedown",this._listeners.click),this.cy.off("tapstart",this._listeners.eventTapstart),this.cy.off("cxttap",this._listeners.eventCyTap)}}]),e}(),Oe=[{selector:".eh-handle",style:{"background-color":"red",width:12,height:12,shape:"ellipse","overlay-opacity":0,"border-width":12,"border-opacity":0,"background-opacity":.5}},{selector:".eh-hover",style:{"background-color":"red","background-opacity":.5}},{selector:".eh-source",style:{"border-width":2,"border-color":"red"}},{selector:".eh-target",style:{"border-width":2,"border-color":"red"}},{selector:".eh-preview, .eh-ghost-edge",style:{"background-color":"red","line-color":"red","target-arrow-color":"red","source-arrow-color":"red"}},{selector:".eh-ghost-edge.eh-preview-active",style:{opacity:0}}],Se=i(308),Le=i.n(Se),De=i(309),Ne=i.n(De),Pe=i(310),Me=i.n(Pe),He=i(311),Re=i.n(He),je=i(312),Ie=i.n(je),Ge=i(313),Be=i.n(Ge),Ae=i(314),$e=i.n(Ae),Ye=i(315),Xe=i.n(Ye),We=[{type:"ellipse",src:Ne.a,bg:"#FFC069",resize:!0,width:76,height:76,category:"基础形状",buildIn:!0},{type:"round-rectangle",src:Le.a,bg:"#1890FF",resize:!0,width:76,height:56,category:"基础形状",buildIn:!0},{type:"diamond",src:Be.a,bg:"#5CDBD3",resize:!0,width:76,height:76,category:"基础形状",buildIn:!0},{type:"pentagon",src:Ie.a,bg:"#722ed1",resize:!0,width:76,height:76,category:"基础形状",buildIn:!0},{type:"tag",src:$e.a,bg:"#efbae4",resize:!0,width:70,height:76,category:"基础形状",buildIn:!0},{type:"star",src:Re.a,bg:"#00e217",resize:!0,width:76,height:76,category:"基础形状",buildIn:!0},{type:"hexagon",src:Me.a,bg:"#ea9f00",resize:!0,width:76,height:70,category:"基础形状",buildIn:!0},{type:"polygon",src:Xe.a,bg:"#f7130e",resize:!0,width:76,height:76,points:[-.33,-1,.33,-1,.33,-.33,1,-.33,1,.33,.33,.33,.33,1,-.33,1,-.33,.33,-1,.33,-1,-.33,-.33,-.33],category:"基础形状",buildIn:!0}];var Ue={cy:{layout:{name:"concentric",fit:!1,concentric:function(e){return 0},minNodeSpacing:100},styleEnabled:!0,style:[].concat(Object($.a)([{selector:"edge",style:{"curve-style":"bezier","target-arrow-shape":"triangle",width:2}},{selector:"edge[lineType]",style:{"curve-style":"data(lineType)"}},{selector:"edge[lineColor]",style:{"target-arrow-shape":"triangle",width:2,"line-color":"data(lineColor)","source-arrow-color":"data(lineColor)","target-arrow-color":"data(lineColor)","mid-source-arrow-color":"data(lineColor)","mid-target-arrow-color":"data(lineColor)"}},{selector:"edge[lineColor]:active",style:{"overlay-color":"#0169D9","overlay-padding":3,"overlay-opacity":.25,"line-color":"data(lineColor)","source-arrow-color":"data(lineColor)","target-arrow-color":"data(lineColor)","mid-source-arrow-color":"data(lineColor)","mid-target-arrow-color":"data(lineColor)"}},{selector:"edge[lineColor]:selected",style:{"overlay-color":"#0169D9","overlay-padding":3,"overlay-opacity":.25,"line-color":"data(lineColor)","source-arrow-color":"data(lineColor)","target-arrow-color":"data(lineColor)","mid-source-arrow-color":"data(lineColor)","mid-target-arrow-color":"data(lineColor)"}}]),Object($.a)([{selector:"node[type]",style:{shape:"data(type)",label:"data(type)",height:"data(height)",width:"data(width)","text-valign":"center","text-halign":"center"}},{selector:"node[points]",style:{"shape-polygon-points":"data(points)",label:"polygon\n(custom points)","text-wrap":"wrap"}},{selector:"node[name]",style:{content:"data(name)"}},{selector:"node[image]",style:{"background-opacity":0,"background-fit":"cover","background-image":function(e){return e.data("image")||{value:""}}}},{selector:"node[bg]",style:{"background-opacity":.45,"background-color":"data(bg)","border-width":1,"border-opacity":.8,"border-color":"data(bg)"}},{selector:"node:active",style:{"overlay-color":"#0169D9","overlay-padding":12,"overlay-opacity":.25}},{selector:"node:selected",style:{"overlay-color":"#0169D9","overlay-padding":12,"overlay-opacity":.25}}]),Object($.a)(Oe)),minZoom:.1,maxZoom:10},editor:{container:"",zoomRate:.2,lineType:"bezier",noderesize:!0,dragAddNodes:!0,elementsInfo:!0,toolbar:!0,snapGrid:!0,contextMenu:!0,navigator:!0,useDefaultNodeTypes:!0,nodeTypes:We,autoSave:!0,beforeAdd:function(e){return!0},afterAdd:function(e){}}},Fe={type:"rectangle",bg:"#999",resize:!0,name:"",width:80,height:80,image:""},Ze={lineColor:"#999"};m.a.use(function(e){e&&e("core","edgehandles",function(e){return new ye(this,e)})}),m.a.use(function(e){e&&e("core","navigator",function(e){return new ne(this,e)})}),m.a.use(function(e){e&&e("core","snapToGrid",function(e){return new Z(this,e)})}),m.a.use(function(e){e&&e("core","noderesize",function(e){return new me(this,e)})}),m.a.use(function(e){e&&e("core","dragAddNodes",function(e){return new Ce(this,e)})}),m.a.use(function(e){e&&e("core","editElements",function(e){return new we(this,e)})}),m.a.use(function(e){e&&e("core","toolbar",function(e){return new F(this,e)})}),m.a.use(function(e){e&&e("core","clipboard",function(e){return new Q(this,e)})}),m.a.use(function(e){e&&e("core","undoRedo",function(e,t){var i=this,n=q(i,"instance")||function(e){var t={options:{isDebug:!1,actions:{},undoableDrag:!0,stackSizeLimit:void 0},actions:{},undoStack:[],redoStack:[],reset:function(e,t){this.undoStack=e||[],this.redoStack=e||[]},undo:function(){if(!this.isUndoStackEmpty()){var t=this.undoStack.pop();e.trigger("cyeditor.beforeUndo",[t.name,t.args]);var i=this.actions[t.name]._undo(t.args);return this.redoStack.push({name:t.name,args:i}),e.trigger("cyeditor.afterUndo",[t.name,t.args,i]),this.options.isDebug&&console.log(this.redoStack,this.undoStack),i}this.options.isDebug&&console.log("Undoing cannot be done because undo stack is empty!")},redo:function(){if(!this.isRedoStackEmpty()){var t=this.redoStack.pop();e.trigger(t.firstTime?"cyeditor.beforeDo":"cyeditor.beforeRedo",[t.name,t.args]),t.args||(t.args={}),t.args.firstTime=!!t.firstTime;var i=this.actions[t.name]._do(t.args);return this.undoStack.push({name:t.name,args:i}),void 0!==this.options.stackSizeLimit&&this.undoStack.length>this.options.stackSizeLimit&&this.undoStack.shift(),e.trigger(t.firstTime?"cyeditor.afterDo":"cyeditor.afterRedo",[t.name,t.args,i]),this.options.isDebug&&console.log(this.redoStack,this.undoStack),i}this.options.isDebug&&console.log("Redoing cannot be done because redo stack is empty!")},do:function(e,t){return this.redoStack.length=0,this.redoStack.push({name:e,args:t,firstTime:!0}),this.redo()},undoAll:function(){for(;!this.isUndoStackEmpty();)this.undo()},redoAll:function(){for(;!this.isRedoStackEmpty();)this.redo()},action:function(e,t,i){return this.actions[e]={_do:t,_undo:i},this},removeAction:function(e){delete this.actions[e]},isUndoStackEmpty:function(){return 0===this.undoStack.length},isRedoStackEmpty:function(){return 0===this.redoStack.length},getUndoStack:function(){return this.undoStack},getRedoStack:function(){return this.redoStack}};return t}(i);if(V(i,"instance",n),e){for(var o in e)n.options.hasOwnProperty(o)&&(n.options[o]=e[o]);if(e.actions)for(var s in e.actions)n.actions[s]=e.actions[s]}if(!q(i,"isInitialized")&&!t){var a=J(i);for(var r in a)n.actions[r]=a[r];!function(e,t){var i=null;e.on("grab","node",function(){("function"==typeof t?t.call(this):t)&&((i={}).lastMouseDownPosition={x:this.position("x"),y:this.position("y")},i.node=this)}),e.on("free","node",function(){var n=q(e,"instance");if("function"==typeof t?t.call(this):t){if(null===i)return;var o=i.node,s=i.lastMouseDownPosition,a={x:o.position("x"),y:o.position("y")};if(a.x!==s.x||a.y!==s.y){var r={positionDiff:{x:a.x-s.x,y:a.y-s.y},nodes:o.selected()?e.nodes(":visible").filter(":selected"):e.collection([o]),move:!1};n.do("drag",r),i=null}}})}(i,n.options.undoableDrag),V(i,"isInitialized",!0)}return n})}),m.a.use(function(e){e&&e("core","contextMenu",function(e){return new ze(this,e)})});var qe=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ue;return Object(u.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this)))._plugins={},e._listeners={},e._init(i),e}return Object(y.a)(t,e),Object(v.a)(t,[{key:"_init",value:function(e){this._initOptions(e),this._initDom(),this._initCy(),this._initPlugin(),this._initEvents()}},{key:"_verifyParams",value:function(e){var t=function(t,i){var n=!0;return t.forEach(function(t){Object(l.a)(e[t])!==i&&(console.warn("'editor.".concat(t,"' must be ").concat(i)),n=!1)}),n},i=e.zoomRate,n=e.toolbar,o=e.nodeTypes;t(["noderesize","dragAddNodes","elementsInfo","snapGrid","navigator","useDefaultNodeTypes","autoSave"],"boolean"),t(["beforeAdd","afterAdd"],"function"),(i<=0||i>=1||"number"!=typeof i)&&console.warn("'editor.zoomRate' must be < 1 and > 0"),"boolean"==typeof n||h()(n)||console.warn("'editor.nodeTypes' must be boolean or array"),h()(o)||console.warn("'editor.nodeTypes' must be array")}},{key:"_initOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.editorOptions=c()({},Ue.editor,e.editor),this._verifyParams(this.editorOptions);var t=this.editorOptions,i=t.useDefaultNodeTypes,n=t.zoomRate;this._handleOptonsChange={snapGrid:this._snapGridChange,lineType:this._lineTypeChange},e.editor&&e.editor.nodeTypes&&i&&this.setOption("nodeTypes",We.concat(e.editor.nodeTypes)),(n<=0||n>=1)&&console.error("zoomRate must be float number, greater than 0 and less than 1"),this.cyOptions=c()({},Ue.cy,e.cy);var o=this.cyOptions.elements;o&&(h()(o.nodes)&&o.nodes.forEach(function(e){e.data=c()({},Fe,e.data)}),h()(o.edges)&&o.edges.forEach(function(e){e.data=c()({},Ze,e.data)}))}},{key:"_initCy",value:function(){this.cyOptions.container="#cy","string"==typeof this.cyOptions.container&&(this.cyOptions.container=I.query(this.cyOptions.container)[0]),this.cyOptions.container?this.cy=m()(this.cyOptions):console.error("There is no any element matching your container")}},{key:"_initDom",value:function(){var e,t=this.editorOptions,i=t.dragAddNodes,n=t.navigator,o=t.elementsInfo,s=t.toolbar,a=t.container,r=i?'<div class="left"></div>':"",c=o?'<div id="info"></div>':"",d=s?'<div id="toolbar"></div>':"",h="";if((n||o)&&(h='<div class="right">\n                '.concat(n?'<div class="panel-title">导航器</div><div id="thumb"></div>':"","\n                ").concat(c,"\n              </div>")),d+='<div id="editor">\n                '.concat(r,'\n                <div id="cy"></div>\n                ').concat(h,"\n              </div>"),a){if("string"==typeof a?e=I.query(a)[0]:I.isNode(a)&&(e=a),!e)return void console.error("There is no any element matching your container")}else(e=document.createElement("div")).className="cy-editor-container",document.body.appendChild(e);e.innerHTML=d}},{key:"_initEvents",value:function(){var e=this,t=this._plugins,i=t.editElements,n=t.edgehandles,o=t.noderesize,s=t.undoRedo;this._listeners.showElementInfo=function(){i&&i.showElementsInfo()},this._listeners.handleCommand=this._handleCommand.bind(this),this._listeners.hoverout=function(e){n&&(n.active=!0,n.stop(e)),o&&o.clearDraws()},this._listeners.select=function(t){"select"!==e._doAction&&s&&e._undoRedoAction("select",t.target)},this._listeners.addEles=function(t,i){if(i.position){var n={pan:e.cy.pan(),zoom:e.cy.zoom()},o=(i.position.x-n.pan.x)/n.zoom,a=(i.position.y-n.pan.y)/n.zoom;i.position={x:o,y:a}}i.firstTime=!0,e._hook("beforeAdd",i,!0)&&(s?e._undoRedoAction("add",i):e.cy.add(i),e._hook("afterAdd",i),e.emit("change",i,e))},this._listeners._changeUndoRedo=this._changeUndoRedo.bind(this),this.cy.on("cyeditor.noderesize-resized cyeditor.noderesize-resizing",this._listeners.showElementInfo).on("cyeditor.toolbar-command",this._listeners.handleCommand).on("click",this._listeners.hoverout).on("select",this._listeners.select).on("cyeditor.addnode",this._listeners.addEles).on("cyeditor.afterDo cyeditor.afterRedo cyeditor.afterUndo",this._listeners._changeUndoRedo),this.emit("ready")}},{key:"_initPlugin",value:function(){var e=this.editorOptions,t=e.dragAddNodes,i=e.elementsInfo,n=e.toolbar,o=e.contextMenu,s=e.snapGrid,a=e.navigator,r=e.noderesize;this._plugins.edgehandles=this.cy.edgehandles({snap:!1,handlePosition:function(){return"middle middle"},edgeParams:this._edgeParams.bind(this)}),t&&(this._plugins.dragAddNodes=this.cy.dragAddNodes({container:".left",nodeTypes:this.editorOptions.nodeTypes})),i&&(this._plugins.editElements=this.cy.editElements({container:"#info"})),(h()(n)||!0===n)&&(this._plugins.toolbar=this.cy.toolbar({container:"#toolbar",toolbar:n}),(!0===n||n.indexOf("gridon")>-1)&&this.setOption("snapGrid",!0));var c=!0===n,d=!0===n;h()(n)&&(c=n.indexOf("undo")>-1||n.indexOf("redo")>-1,d=n.indexOf("copy")>-1||n.indexOf("paset")>-1),d&&(this._plugins.clipboard=this.cy.clipboard()),c&&(this._plugins.undoRedo=this.cy.undoRedo()),s&&(this._plugins.cySnapToGrid=this.cy.snapToGrid()),a&&this.cy.navigator({container:"#thumb"}),r&&(this._plugins.noderesize=this.cy.noderesize({selector:"node[resize]"})),o&&(this._plugins.contextMenu=this.cy.contextMenu())}},{key:"_snapGridChange",value:function(){this._plugins.cySnapToGrid&&(this.editorOptions.snapGrid?(this._plugins.cySnapToGrid.gridOn(),this._plugins.cySnapToGrid.snapOn()):(this._plugins.cySnapToGrid.gridOff(),this._plugins.cySnapToGrid.snapOff()))}},{key:"_edgeParams",value:function(){return{data:{lineType:this.editorOptions.lineType}}}},{key:"_lineTypeChange",value:function(e){var t=this.cy.$("edge:selected");t.length<1&&(t=this.cy.$("edge")),t.forEach(function(t){t.data({lineType:e})})}},{key:"_handleCommand",value:function(e,t){switch(t.command){case"undo":this.undo();break;case"redo":this.redo();break;case"gridon":this.toggleGrid();break;case"zoomin":this.zoom(1);break;case"zoomout":this.zoom(-1);break;case"levelup":this.changeLevel(1);break;case"leveldown":this.changeLevel(-1);break;case"copy":this.copy();break;case"paste":this.paste();break;case"fit":this.fit();break;case"save":this.save();break;case"delete":this.deleteSelected();break;case"line-bezier":this.setOption("lineType","bezier");break;case"line-taxi":this.setOption("lineType","taxi");break;case"line-straight":this.setOption("lineType","straight");break;case"boxselect":this.cy.userPanningEnabled(!t.selected),this.cy.boxSelectionEnabled(t.selected)}}},{key:"_changeUndoRedo",value:function(){if(this._plugins.undoRedo&&this._plugins.toolbar){var e=this._plugins.undoRedo.isRedoStackEmpty(),t=this._plugins.undoRedo.isUndoStackEmpty();e===this.lastCanRedo&&t===this.lastCanUndo||(this._plugins.toolbar.rerender("undo",{disabled:t}),this._plugins.toolbar.rerender("redo",{disabled:e})),this.lastCanRedo=e,this.lastCanUndo=t}}},{key:"_undoRedoAction",value:function(e,t){this._doAction=e,this._plugins.undoRedo.do(e,t)}},{key:"_hook",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("function"==typeof this.editorOptions[e]){var n=this.editorOptions[e](t);return!i||n}}},{key:"setOption",value:function(e,t){"string"==typeof e?(this.editorOptions[e]=t,"function"==typeof this._handleOptonsChange[e]&&this._handleOptonsChange[e].call(this,t)):"object"===Object(l.a)(e)&&c()(this.editorOptions,e)}},{key:"undo",value:function(){if(this._plugins.undoRedo){var e=this._plugins.undoRedo.getRedoStack();e.length&&(this._doAction=e[e.length-1].action),this._plugins.undoRedo.undo()}else console.warn("Can not `undo`, please check the initialize option `editor.toolbar`")}},{key:"redo",value:function(){if(this._plugins.undoRedo){var e=this._plugins.undoRedo.getUndoStack();e.length&&(this._doAction=e[e.length-1].action),this._plugins.undoRedo.redo()}else console.warn("Can not `redo`, please check the initialize option `editor.toolbar`")}},{key:"copy",value:function(){if(this._plugins.clipboard){var e=this.cy.$(":selected");e.length&&(this._cpids=this._plugins.clipboard.copy(e),this._cpids&&this._plugins.toolbar&&this._plugins.toolbar.rerender("paste",{disabled:!1}))}else console.warn("Can not `copy`, please check the initialize option `editor.toolbar`")}},{key:"paste",value:function(){this._plugins.clipboard?this._cpids&&this._plugins.clipboard.paste(this._cpids):console.warn("Can not `paste`, please check the initialize option `editor.toolbar`")}},{key:"changeLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.cy.$(":selected");t.length&&t.forEach(function(t){var i=t.style();t.style("z-index",i.zIndex-0+e>-1?i.zIndex-0+e:0)})}},{key:"deleteSelected",value:function(){var e=this.cy.$(":selected");e.length&&(this._plugins.undoRedo&&this._undoRedoAction("remove",e),this.cy.remove(e))}},{key:"save",value:function(){var e=Object(a.a)(regeneratorRuntime.mark(function e(){var t,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.cy.png({output:"blob-promise"});case 3:t=e.sent,window.navigator.msSaveBlob?window.navigator.msSaveBlob(t,"chart-".concat(s()(),".png")):((i=document.createElement("a")).download="chart-".concat(s()(),".png"),i.href=window.URL.createObjectURL(t),i.click()),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"fit",value:function(){this._fit_status?(this.cy.viewport({zoom:this._fit_status.zoom,pan:this._fit_status.pan}),this._fit_status=null):(this._fit_status={pan:this.cy.pan(),zoom:this.cy.zoom()},this.cy.fit())}},{key:"zoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;t=t||this.editorOptions.zoomRate;var i=this.cy.width(),n=this.cy.height(),o=this.cy.zoom()+t*e,s=this.cy.pan();s.x=s.x+-1*i*t*e/2,s.y=s.y+-1*n*t*e/2,this.cy.viewport({zoom:o,pan:s})}},{key:"toggleGrid",value:function(){this._plugins.cySnapToGrid?this.setOption("snapGrid",!this.editorOptions.snapGrid):console.warn("Can not `toggleGrid`, please check the initialize option")}},{key:"jpg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.cy.png(e)}},{key:"png",value:function(e){return this.cy.png(e)}},{key:"json",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;t=t||["boxSelectionEnabled","elements","pan","panningEnabled","userPanningEnabled","userZoomingEnabled","zoom","zoomingEnabled"];var i={};if("boolean"==typeof e){var n=this.cy.json(e);return t.forEach(function(e){i[e]=n[e]}),i}return"object"===Object(l.a)(e)&&(i={},t.forEach(function(t){i[t]=e[t]})),this.cy.json(i)}},{key:"data",value:function(e,t){return this.cy.data(e,t)}},{key:"removeData",value:function(e){this.cy.removeData(e)}},{key:"destroy",value:function(){this.cy.removeAllListeners(),this.cy.destroy()}}]),t}(W),Ve={name:"App",components:{cyEditor:{name:"CyEditor",props:{value:{type:Object,default:function(){return{boxSelectionEnabled:!0,elements:null,pan:{x:0,y:0},panningEnabled:!0,userPanningEnabled:!0,userZoomingEnabled:!0,zoom:1,zoomingEnabled:!0}}},cyConfig:{type:Object,default:function(){return{}}},editorConfig:{type:Object,default:function(){return{}}}},mounted:function(){var e=this.$el,t={cy:Object(n.a)({},this.cyConfig),editor:Object(n.a)({container:e},this.editorConfig)};this.cyEditor=new qe(t),this.cyEditor.json(this.value),this.cyEditor.on("change",function(e,t){})},render:function(e){return e("div")}}},data:function(){return{value:{zoom:.7,pan:{x:100,y:40},elements:{nodes:[{data:{type:"round-rectangle",name:"开始",resize:!0,bg:"#1890FF",width:76,height:56,id:"a79249d9-4d5b-43e1-b268-d389df7ed592"},position:{x:192.5,y:52.5}},{data:{type:"round-rectangle",name:"",resize:!0,bg:"#1890FF",width:76,height:56,id:"27e14443-0b39-446f-94e2-3e521a1706f9"},position:{x:87.5,y:262.5}},{data:{type:"diamond",name:"条件",resize:!0,bg:"#5CDBD3",width:156,height:52,id:"4072b83e-b702-4168-b548-56bcc52eebd9"},position:{x:192.5,y:157.5}},{data:{type:"round-rectangle",name:"",resize:!0,bg:"#1890FF",width:76,height:56,id:"6be4a6b0-49e2-4b2c-b3bd-135684da938a"},position:{x:297.5,y:262.5}}],edges:[{data:{source:"a79249d9-4d5b-43e1-b268-d389df7ed592",target:"4072b83e-b702-4168-b548-56bcc52eebd9",lineType:"taxi",id:"3e6d9858-adbe-4b73-828d-d0732ac29279"},position:{x:17.5,y:17.5}},{data:{source:"4072b83e-b702-4168-b548-56bcc52eebd9",target:"27e14443-0b39-446f-94e2-3e521a1706f9",lineType:"taxi",id:"b63708fe-3b53-469a-b908-4c9608112164"},position:{x:17.5,y:17.5}},{data:{source:"4072b83e-b702-4168-b548-56bcc52eebd9",target:"6be4a6b0-49e2-4b2c-b3bd-135684da938a",lineType:"taxi",id:"0c4d0dc9-a2ee-4ea5-b422-4730913a7ab1"},position:{x:17.5,y:17.5}}]}},cyConfig:{},editorConfig:{lineType:"taxi"}}},mounted:function(){},computed:{},methods:{change:function(){}}},Je=(i(316),i(0)),Ke=Object(Je.a)(Ve,function(){var e=this.$createElement;return(this._self._c||e)("cy-editor",{staticClass:"cy-editor",attrs:{value:this.value,"cy-config":this.cyConfig,"editor-config":this.editorConfig},on:{change:this.change}})},[],!1,null,"6b9b38db",null).exports,Qe=Object(Je.a)(Ke,void 0,void 0,!1,null,null,null);t.default=Qe.exports}}]);